<?php echo $this->getContent(); ?>
<section class="gallery">
    <div class="gallery-header">
        <h1>Thư viện Ảnh</h1>
        <span>tin tức cập nhập thường xuyên</span>
    </div>
    <div class="menu-common">
        <div class="decor"></div>
        <ul>
            <?php foreach ($data->items as $item): ?>
                <?php echo "<li><a href=\"#\">$item->name</a></li>" ?>
            <?php endforeach; ?>
        </ul>
        <div class="decor"></div>
    </div>
    <div class="gallery-content" id="gallery-content">
            <?php foreach ($data->items as $item): ?>
            <div class="gallery-content container">
                <div class="row">
                    <div class="text-content col-md-3">
                        <div class="overlay background-ov">
                            <img class="img-responsive" src="<?php echo '\\' . $item->dir ?>" alt="nha">
                        </div>
                        <h3><a href=""><?php echo $item->name ?></a></h3>
                    </div>
                    
                </div>
            </div>
        <?php endforeach; ?>
    </div>
</section>
<script defer type="text/javascript">
    var is_loading = false; // initialize is_loading by false to accept new loading
    var pages = 2;
    var end = 'false';
    $(document).ready(function () {
        $(window).scroll(function () {
            var page = {'page': pages, 'endpage': end};
            if (is_loading == false & end == 'false') {
                is_loading = true;
                $.ajax({
                    url: '/gallery/morealbum',
                    type: 'POST',
                    data: page,
                    dataType: 'json',
                    success: function (result) {
                        if (result.endload != 'end') {
                            var html = '<div class="text-content">';
                            $.each(result.albums, function (key, item) {
                                html += '<div class="overlay">'
                                html += '<img class="img-responsive" src="\\' + item.dir + '" >'
                                html += '</div>'
                                html += '<h3><a href="/gallery/detail/#">' + item.name + '</a></h3>'
                            });
                            html += '</div>';
                            $('#gallery-content').append(html);
                        }
                        // append: add the new statments to the existing data
                        pages = result.nextpage;
                        end = result.endpage;
                        // set is_loading to false to accept new loading
                        is_loading = false;
                    },
                    error: function (jqXHR, exception) {
                        var msg = '';
                        if (jqXHR.status === 0) {
                            msg = 'Not connect.\n Verify Network.';
                        } else if (jqXHR.status == 404) {
                            msg = 'Requested page not found. [404]';
                        } else if (jqXHR.status == 500) {
                            msg = 'Internal Server Error [500].';
                        } else if (exception === 'parsererror') {
                            msg = 'Requested JSON parse failed.';
                        } else if (exception === 'timeout') {
                            msg = 'Time out error.';
                        } else if (exception === 'abort') {
                            msg = 'Ajax request aborted.';
                        } else {
                            msg = 'Uncaught Error.\n' + jqXHR.responseText;
                        }
                        console.log(msg);
                    }
                });
            }
        });
    });
</script>